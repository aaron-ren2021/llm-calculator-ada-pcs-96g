<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM地端部署效能計算器 - RTX PRO 6000</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeInUp 0.8s ease;
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: #555;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .slider-container {
            margin-top: 10px;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #764ba2;
        }

        .slider-value {
            text-align: center;
            color: #667eea;
            font-weight: bold;
            margin-top: 5px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .result-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            color: white;
            text-align: center;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .result-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .result-unit {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #856404;
        }

        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #155724;
        }

        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #0c5460;
        }

        .gpu-spec {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .gpu-spec h3 {
            color: #76b900;
            margin-bottom: 10px;
        }

        .spec-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .spec-item {
            font-size: 0.9rem;
            color: #666;
        }

        .spec-item strong {
            color: #333;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
            font-weight: 600;
        }

        .calculate-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .tooltip {
            position: relative;
            display: inline-block;
            color: #667eea;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 LLM地端部署效能計算器</h1>
            <p>基於 NVIDIA RTX PRO 6000 Blackwell Server Edition 的企業級AI推論平台</p>
        </div>

        <div class="main-grid">
            <!-- 硬體配置 -->
            <div class="card">
                <h2>⚙️ 硬體配置</h2>
                
                <div class="gpu-spec">
                    <h3>RTX PRO 6000 規格</h3>
                    <div class="spec-list">
                        <div class="spec-item"><strong>記憶體:</strong> 96GB GDDR7</div>
                        <div class="spec-item"><strong>頻寬:</strong> 1597 GB/s</div>
                        <div class="spec-item"><strong>FP4 AI:</strong> 4 PFLOPS</div>
                        <div class="spec-item"><strong>功耗:</strong> 最高600W</div>
                    </div>
                </div>

                <div class="input-group">
                    <label>CPU 核心數 
                        <span class="tooltip">ℹ️
                            <span class="tooltiptext">CPU核心數影響並行處理能力，建議配置較高核心數以支援多用戶同時存取</span>
                        </span>
                    </label>
                    <input type="range" id="cpuCores" class="slider" min="12" max="128" value="64" step="4">
                    <div class="slider-value" id="cpuCoresValue">64 核心</div>
                </div>

                <div class="input-group">
                    <label>GPU 數量 (RTX PRO 6000)</label>
                    <select id="gpuCount">
                        <option value="1">1 張 (96GB VRAM)</option>
                        <option value="2" selected>2 張 (192GB VRAM)</option>
                        <option value="3">3 張 (288GB VRAM)</option>
                        <option value="4">4 張 (384GB VRAM)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>系統記憶體 (RAM)</label>
                    <select id="systemRam">
                        <option value="256">256 GB</option>
                        <option value="384" selected>384 GB</option>
                        <option value="512">512 GB</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>網路配置</label>
                    <select id="networkConfig">
                        <option value="20">雙 10GbE (20 Gbps)</option>
                        <option value="40">雙 25GbE (50 Gbps)</option>
                        <option value="80">雙 40GbE (80 Gbps)</option>
                    </select>
                </div>
            </div>

            <!-- LLM 模型配置 -->
            <div class="card">
                <h2>🤖 LLM 模型配置</h2>
                
                <div class="input-group">
                    <label>模型選擇
                        <span class="tooltip">ℹ️
                            <span class="tooltiptext">選擇要部署的LLM模型，不同模型有不同的記憶體需求和效能表現</span>
                        </span>
                    </label>
                    <select id="modelSelect">
                        <option value="7">Llama 3.1 8B (約4GB)</option>
                        <option value="13">Llama 2 13B (約8GB)</option>
                        <option value="30">Llama 2 30B (約18GB)</option>
                        <option value="70" selected>Llama 3.1 70B (約40GB)</option>
                        <option value="405">Llama 3.1 405B (約230GB)</option>
                        <option value="custom">自訂模型</option>
                    </select>
                </div>

                <div class="input-group" id="customModelSize" style="display: none;">
                    <label>自訂模型大小 (GB)</label>
                    <input type="number" id="customSize" min="1" max="400" value="50">
                </div>

                <div class="input-group">
                    <label>量化精度
                        <span class="tooltip">ℹ️
                            <span class="tooltiptext">FP4提供最高效能和最低記憶體使用，INT8平衡效能與精度，FP16提供最高精度</span>
                        </span>
                    </label>
                    <select id="quantization">
                        <option value="0.25">FP4 (4-bit)</option>
                        <option value="0.5" selected>INT8 (8-bit)</option>
                        <option value="1">FP16 (16-bit)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>平均上下文長度 (tokens)</label>
                    <input type="range" id="contextLength" class="slider" min="512" max="8192" value="2048" step="512">
                    <div class="slider-value" id="contextLengthValue">2048 tokens</div>
                </div>

                <div class="input-group">
                    <label>批次大小 (Batch Size)</label>
                    <input type="range" id="batchSize" class="slider" min="1" max="32" value="8" step="1">
                    <div class="slider-value" id="batchSizeValue">8</div>
                </div>

                <button class="calculate-btn" onclick="calculatePerformance()">計算效能與容量</button>
            </div>
        </div>

        <!-- 計算結果 -->
        <div class="card">
            <h2>📊 效能分析結果</h2>
            
            <div class="results-grid">
                <div class="result-item">
                    <div class="result-label">總GPU記憶體</div>
                    <div class="result-value" id="totalVram">192</div>
                    <div class="result-unit">GB</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">模型記憶體佔用</div>
                    <div class="result-value" id="modelMemory">40</div>
                    <div class="result-unit">GB</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">同時使用人數</div>
                    <div class="result-value" id="maxUsers">24</div>
                    <div class="result-unit">人</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">推論速度</div>
                    <div class="result-value" id="inferenceSpeed">120</div>
                    <div class="result-unit">tokens/秒</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">記憶體使用率</div>
                    <div class="result-value" id="memoryUsage">65</div>
                    <div class="result-unit">%</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">網路吞吐量</div>
                    <div class="result-value" id="networkThroughput">85</div>
                    <div class="result-unit">%</div>
                </div>
            </div>

            <div id="statusMessage"></div>
            
            <div class="info-box" style="margin-top: 20px;">
                <h4>💡 效能建議</h4>
                <p id="performanceAdvice">基於當前配置，系統可穩定支援24位用戶同時使用，建議啟用MIG功能以優化資源分配。</p>
            </div>
        </div>

        <!-- 詳細分析 -->
        <div class="card">
            <h2>📈 詳細分析報告</h2>
            
            <div id="detailedAnalysis">
                <h3>記憶體分配明細</h3>
                <ul style="color: #666; line-height: 1.8; margin: 15px 0;">
                    <li>模型權重: <span id="modelWeightMem">40 GB</span></li>
                    <li>KV Cache (每用戶): <span id="kvCacheMem">2 GB</span></li>
                    <li>激活值緩衝: <span id="activationMem">8 GB</span></li>
                    <li>系統預留: <span id="systemReserved">10 GB</span></li>
                </ul>

                <h3>效能預估</h3>
                <ul style="color: #666; line-height: 1.8; margin: 15px 0;">
                    <li>首字延遲 (TTFT): <span id="ttft">~500ms</span></li>
                    <li>每秒生成tokens: <span id="tokensPerSec">120 tokens/s</span></li>
                    <li>P95延遲: <span id="p95Latency">~2s</span></li>
                    <li>建議QPS: <span id="recommendedQps">10-15</span></li>
                </ul>

                <h3>擴展性分析</h3>
                <ul style="color: #666; line-height: 1.8; margin: 15px 0;">
                    <li>當前配置最大用戶數: <span id="currentMaxUsers">24</span></li>
                    <li>增加1張GPU可支援: <span id="additionalUsers">+12 用戶</span></li>
                    <li>建議的最佳配置: <span id="optimalConfig">3張GPU + 384GB RAM</span></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // 初始化滑桿顯示
        document.getElementById('cpuCores').addEventListener('input', function() {
            document.getElementById('cpuCoresValue').textContent = this.value + ' 核心';
        });

        document.getElementById('contextLength').addEventListener('input', function() {
            document.getElementById('contextLengthValue').textContent = this.value + ' tokens';
        });

        document.getElementById('batchSize').addEventListener('input', function() {
            document.getElementById('batchSizeValue').textContent = this.value;
        });

        // 模型選擇變更
        document.getElementById('modelSelect').addEventListener('change', function() {
            const customDiv = document.getElementById('customModelSize');
            if (this.value === 'custom') {
                customDiv.style.display = 'block';
            } else {
                customDiv.style.display = 'none';
            }
        });

        function calculatePerformance() {
            // 獲取輸入值
            const cpuCores = parseInt(document.getElementById('cpuCores').value);
            const gpuCount = parseInt(document.getElementById('gpuCount').value);
            const systemRam = parseInt(document.getElementById('systemRam').value);
            const networkBandwidth = parseInt(document.getElementById('networkConfig').value);
            const modelSelect = document.getElementById('modelSelect').value;
            const quantization = parseFloat(document.getElementById('quantization').value);
            const contextLength = parseInt(document.getElementById('contextLength').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);

            // 計算模型大小
            let modelSizeGB;
            const modelSizes = {
                '7': 4,
                '13': 8,
                '30': 18,
                '70': 40,
                '405': 230
            };

            if (modelSelect === 'custom') {
                modelSizeGB = parseInt(document.getElementById('customSize').value);
            } else {
                modelSizeGB = modelSizes[modelSelect];
            }

            // 應用量化係數
            const actualModelSize = modelSizeGB * quantization;

            // 計算總GPU記憶體
            const totalVram = gpuCount * 96;

            // 計算KV Cache (每用戶)
            const kvCachePerUser = (contextLength / 1024) * 0.5 * quantization; // 簡化計算

            // 計算激活值緩衝
            const activationBuffer = batchSize * 1;

            // 系統預留 (10%)
            const systemReserved = totalVram * 0.1;

            // 可用記憶體
            const availableMemory = totalVram - actualModelSize - activationBuffer - systemReserved;

            // 計算最大並發用戶數
            const maxConcurrentUsers = Math.floor(availableMemory / kvCachePerUser);

            // 計算推論速度 (基於RTX PRO 6000的FP4 4 PFLOPS)
            let baseSpeed = 150; // 基準速度
            if (quantization === 0.25) baseSpeed *= 2; // FP4加速
            if (quantization === 1) baseSpeed *= 0.5; // FP16較慢
            const inferenceSpeed = Math.round(baseSpeed * (gpuCount * 0.8)); // 多GPU有一定損耗

            // 記憶體使用率
            const memoryUsage = Math.round(((actualModelSize + activationBuffer + kvCachePerUser * maxConcurrentUsers) / totalVram) * 100);

            // 網路吞吐量評估
            const estimatedNetworkUsage = (maxConcurrentUsers * 0.5); // MB/s per user
            const networkUtilization = Math.min(100, Math.round((estimatedNetworkUsage / (networkBandwidth * 125)) * 100));

            // 更新顯示
            document.getElementById('totalVram').textContent = totalVram;
            document.getElementById('modelMemory').textContent = actualModelSize.toFixed(1);
            document.getElementById('maxUsers').textContent = maxConcurrentUsers;
            document.getElementById('inferenceSpeed').textContent = inferenceSpeed;
            document.getElementById('memoryUsage').textContent = memoryUsage;
            document.getElementById('networkThroughput').textContent = networkUtilization;

            // 更新詳細分析
            document.getElementById('modelWeightMem').textContent = actualModelSize.toFixed(1) + ' GB';
            document.getElementById('kvCacheMem').textContent = kvCachePerUser.toFixed(2) + ' GB';
            document.getElementById('activationMem').textContent = activationBuffer.toFixed(1) + ' GB';
            document.getElementById('systemReserved').textContent = systemReserved.toFixed(1) + ' GB';

            // 效能指標
            const ttft = Math.round(500 + (modelSizeGB / 10) * 50);
            document.getElementById('ttft').textContent = '~' + ttft + 'ms';
            document.getElementById('tokensPerSec').textContent = inferenceSpeed + ' tokens/s';
            document.getElementById('p95Latency').textContent = '~' + (ttft / 250).toFixed(1) + 's';
            document.getElementById('recommendedQps').textContent = Math.round(maxConcurrentUsers / 2) + '-' + Math.round(maxConcurrentUsers * 0.75);

            // 擴展性分析
            document.getElementById('currentMaxUsers').textContent = maxConcurrentUsers;
            document.getElementById('additionalUsers').textContent = '+' + Math.round(96 / kvCachePerUser) + ' 用戶';
            
            // 最佳配置建議
            let optimalGpus = 2;
            if (modelSizeGB > 80) optimalGpus = 3;
            if (modelSizeGB > 200) optimalGpus = 4;
            document.getElementById('optimalConfig').textContent = optimalGpus + '張GPU + ' + (optimalGpus * 128) + 'GB RAM';

            // 狀態訊息
            const statusDiv = document.getElementById('statusMessage');
            if (memoryUsage > 90) {
                statusDiv.className = 'warning';
                statusDiv.innerHTML = '<strong>⚠️ 警告:</strong> 記憶體使用率過高，建議增加GPU數量或降低並發用戶數。';
            } else if (memoryUsage < 50) {
                statusDiv.className = 'info-box';
                statusDiv.innerHTML = '<strong>💡 提示:</strong> 記憶體使用率較低，可考慮部署更大的模型或增加並發用戶數。';
            } else {
                statusDiv.className = 'success';
                statusDiv.innerHTML = '<strong>✅ 良好:</strong> 系統配置平衡，可穩定運行。';
            }

            // 效能建議
            let advice = '';
            if (maxConcurrentUsers < 10) {
                advice = '當前配置支援用戶數較少，建議增加GPU數量或使用較小的模型。';
            } else if (maxConcurrentUsers > 50) {
                advice = '系統可支援大量並發用戶，建議啟用MIG功能進行資源隔離，確保服務品質。';
            } else {
                advice = `基於當前配置，系統可穩定支援${maxConcurrentUsers}位用戶同時使用。建議監控實際使用情況並適時調整。`;
            }
            
            if (gpuCount > 2) {
                advice += ' 多GPU配置建議使用張量並行或流水線並行以優化效能。';
            }
            
            document.getElementById('performanceAdvice').textContent = advice;
        }

        // 初始計算
        calculatePerformance();
    </script>
</body>
</html>